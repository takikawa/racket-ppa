
# Builds MzScheme and MrEd

srcdir = @srcdir@
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
libdir = @libdir@
includepltdir = @includepltdir@
libpltdir = @libpltdir@
collectsdir = @collectsdir@
mandir = @mandir@
docdir = @docdir@
builddir = @builddir@

ALLDIRINFO = "$(bindir)" "$(collectsdir)" "$(docdir)" "$(libdir)" "$(includepltdir)" "$(libpltdir)" "$(mandir)"

all:
	$(MAKE) mz
	$(MAKE) mred-stub

mred-stub: @MAKE_MRED@


3m:
	$(MAKE) mz3m
	$(MAKE) mred3m-stub

mred3m-stub: @MAKE_MRED3M@


plain-install:
	$(MAKE) install-normal

install:
	$(MAKE) plain-install
	$(MAKE) setup-plt

install-normal:
	mkdir -p $(ALLDIRINFO)
	if [ ! -d $(prefix) ] ; then mkdir $(prefix) ; fi
	$(MAKE) mzinstall
	$(MAKE) mredinstall-stub
	$(MAKE) copytree-stub
	$(MAKE) lib-finish

copytree-stub: @MAKE_COPYTREE@

mredinstall-stub: @MAKE_MREDINSTALL@

setup-plt:
	$(prefix)/bin/mzscheme -mvqM setup

plain-install-3m:
	$(MAKE) install-normal
	$(MAKE) mzinstall3m
	$(MAKE) mredinstall3m-stub

install-3m:
	$(MAKE) plain-install-3m
	$(MAKE) setup-plt

mredinstall3m-stub: @MAKE_MREDINSTALL3M@


clean:
	cd mzscheme; $(MAKE) clean
	if [ -d mred ] ; then cd mred; $(MAKE) clean; fi


mz:
	cd mzscheme; $(MAKE)

mz3m:
	cd mzscheme; $(MAKE) 3m

mr:
	cd mred; $(MAKE)

mr3m:
	cd mred; $(MAKE) 3m


mzinstall:
	cd mzscheme; $(MAKE) install

mzinstall3m:
	cd mzscheme; $(MAKE) install-3m

mrinstall:
	cd mred; $(MAKE) install

mrinstall3m:
	cd mred; $(MAKE) install-3m

lib-finish:
	@LIBFINISH@ "$(prefix)/lib"

copytree:
	mzscheme/mzscheme -mvqu "$(srcdir)/copytree.ss" \
          "$(srcdir)/.." $(ALLDIRINFO) @INSTALL_ORIG_TREE@
