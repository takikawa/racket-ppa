#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/patchsys-quilt.mk

DEB_HOST_ARCH ?= $(shell dpkg-architecture -qDEB_HOST_ARCH)
DEB_CONFIGURE_SCRIPT := $(CURDIR)/src/configure
# Some architectures don't like the 3m garbage collector, so use Boehm (aka
# cgc)
ifneq (,$(filter alpha mips mipsel,$(DEB_HOST_ARCH)))
    DEB_CONFIGURE_EXTRA_FLAGS := --enable-cgcdefault
endif
# Upstream does funky things with assembly, so we'll have to trust their 
# compilation settings and override cdbs/dpkg-buildpackage defaults for
# configure and make
DEB_CONFIGURE_SCRIPT_ENV = CFLAGS="" CXXFLAGS=""
DEB_MAKE_ENVVARS = CFLAGS="" CXXFLAGS=""

DEB_BUILDDIR := $(DEB_SRCDIR)/build

binary-post-install/plt-scheme::
	rm -f debian/plt-scheme/usr/lib/plt/collects/profj/classpath/COPYING
	rm -f debian/plt-scheme/usr/lib/plt/collects/profj/classpath/LICENSE
	rmdir debian/plt-scheme/usr/lib/plt/collects/profj/classpath

binary-post-install/plt-scheme-doc::
	# release-notes get installed into plt-scheme
	rm -rf debian/plt-scheme-doc/usr/share/plt/doc/release-notes

cleanbuilddir/plt-scheme::
	rm -rf build
	rm -rf include # This got created at build-time
